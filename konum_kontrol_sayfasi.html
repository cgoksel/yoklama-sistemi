<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yoklama - Konum KontrolÃ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            text-align: center;
        }

        .logo {
            font-size: 64px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 28px;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .status {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 600;
        }

        .status.loading {
            background: #dbeafe;
            color: #1e40af;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info-box {
            background: #f9fafb;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
        }

        .info-box p {
            font-size: 13px;
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .info-box p:last-child {
            margin-bottom: 0;
        }

        .info-label {
            font-weight: 600;
            color: #1f2937;
        }

        .btn {
            display: inline-block;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            margin-top: 20px;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .distance-info {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ğŸ“</div>
        <h1>Yoklama Sistemi</h1>
        <p class="subtitle">Manisa CBÃœ SaÄŸlÄ±k Bilimleri FakÃ¼ltesi</p>

        <div id="statusBox" class="status loading">
            <div class="spinner"></div>
            <p>Konumunuz kontrol ediliyor...</p>
        </div>

        <div id="infoBox" class="info-box" style="display: none;">
            <p><span class="info-label">ğŸ“ Konumunuz:</span> <span id="userLocation">--</span></p>
            <p><span class="info-label">ğŸ« SÄ±nÄ±f Konumu:</span> B Blok</p>
            <p><span class="info-label">ğŸ“ Mesafe:</span> <span id="distance">--</span></p>
        </div>
    </div>

    <script>
        // BURAYA GOOGLE FORMS LÄ°NKÄ°NÄ°ZÄ° YAPIÅTIRIN
        const GOOGLE_FORMS_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfqplDmOLMy3IAzEcvVfJsCSEjrobG1njhfxDF49NVYzLhPLQ/viewform?usp=pp_url&entry.1353730145=KONUM_BURAYA";
        
        // SÄ±nÄ±f koordinatlarÄ±
        const SINIF_LAT = 38.610465;
        const SINIF_LON = 27.381204;
        const YARICAP_METRE = 100; // 100 metre yarÄ±Ã§ap

        // Ä°ki koordinat arasÄ±ndaki mesafeyi hesapla (Haversine formÃ¼lÃ¼)
        function hesaplaMesafe(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // DÃ¼nya yarÄ±Ã§apÄ± (metre)
            const Ï†1 = lat1 * Math.PI / 180;
            const Ï†2 = lat2 * Math.PI / 180;
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
            const Î”Î» = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Metre cinsinden mesafe
        }

        // BaÅŸarÄ± durumu
        function konumBasarili(position) {
            const userLat = position.coords.latitude;
            const userLon = position.coords.longitude;
            const dogruluk = Math.round(position.coords.accuracy);

            // Mesafeyi hesapla
            const mesafe = hesaplaMesafe(userLat, userLon, SINIF_LAT, SINIF_LON);
            const mesafeStr = Math.round(mesafe) + " metre";

            // Bilgi kutusunu gÃ¶ster
            document.getElementById('userLocation').textContent = 
                `${userLat.toFixed(6)}, ${userLon.toFixed(6)} (Â±${dogruluk}m)`;
            document.getElementById('distance').textContent = mesafeStr;
            document.getElementById('infoBox').style.display = 'block';

            const statusBox = document.getElementById('statusBox');

            // SÄ±nÄ±f iÃ§inde mi kontrol et
            if (mesafe <= YARICAP_METRE) {
                // BAÅARILI - SÄ±nÄ±f iÃ§inde
                statusBox.className = 'status success';
                statusBox.innerHTML = `
                    <p style="font-size: 48px; margin-bottom: 10px;">âœ…</p>
                    <p>Konum DoÄŸrulandÄ±!</p>
                    <p style="font-size: 14px; margin-top: 10px; opacity: 0.8;">SÄ±nÄ±f iÃ§indesiniz. Form aÃ§Ä±lÄ±yor...</p>
                `;

                // Konum bilgisini Google Forms linkine ekle
                const konumBilgisi = `${userLat.toFixed(6)},${userLon.toFixed(6)} (${mesafeStr})`;
                const formUrl = GOOGLE_FORMS_URL.replace('KONUM_BURAYA', encodeURIComponent(konumBilgisi));

                // 2 saniye sonra Google Forms'a yÃ¶nlendir
                setTimeout(() => {
                    window.location.href = formUrl;
                }, 2000);

            } else {
                // HATA - SÄ±nÄ±f dÄ±ÅŸÄ±nda
                statusBox.className = 'status error';
                statusBox.innerHTML = `
                    <p style="font-size: 48px; margin-bottom: 10px;">âŒ</p>
                    <p>SÄ±nÄ±f DÄ±ÅŸÄ±ndasÄ±nÄ±z!</p>
                    <p style="font-size: 14px; margin-top: 10px; opacity: 0.8;">Yoklama vermek iÃ§in sÄ±nÄ±fta olmalÄ±sÄ±nÄ±z.</p>
                    <div class="distance-info">${mesafeStr} uzaktasÄ±nÄ±z</div>
                    <p style="font-size: 12px; margin-top: 10px; opacity: 0.7;">Ä°zin verilen mesafe: ${YARICAP_METRE} metre</p>
                `;
            }
        }

        // Hata durumu
        function konumHatasi(error) {
            const statusBox = document.getElementById('statusBox');
            statusBox.className = 'status error';

            let mesaj = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    mesaj = "Konum izni reddedildi. LÃ¼tfen tarayÄ±cÄ± ayarlarÄ±ndan konum iznini aÃ§Ä±n.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    mesaj = "Konum bilgisi alÄ±namadÄ±. GPS'inizi kontrol edin.";
                    break;
                case error.TIMEOUT:
                    mesaj = "Konum alma zaman aÅŸÄ±mÄ±na uÄŸradÄ±. Tekrar deneyin.";
                    break;
                default:
                    mesaj = "Bilinmeyen bir hata oluÅŸtu.";
            }

            statusBox.innerHTML = `
                <p style="font-size: 48px; margin-bottom: 10px;">âš ï¸</p>
                <p>Konum AlÄ±namadÄ±</p>
                <p style="font-size: 14px; margin-top: 10px; opacity: 0.8;">${mesaj}</p>
                <a href="#" onclick="window.location.reload()" class="btn">Tekrar Dene</a>
            `;
        }

        // Sayfa yÃ¼klendiÄŸinde konum al
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(konumBasarili, konumHatasi, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            });
        } else {
            document.getElementById('statusBox').className = 'status error';
            document.getElementById('statusBox').innerHTML = `
                <p style="font-size: 48px; margin-bottom: 10px;">âŒ</p>
                <p>TarayÄ±cÄ±nÄ±z Konum DesteÄŸi Vermiyor</p>
                <p style="font-size: 14px; margin-top: 10px; opacity: 0.8;">LÃ¼tfen modern bir tarayÄ±cÄ± kullanÄ±n.</p>
            `;
        }
    </script>
</body>
</html>